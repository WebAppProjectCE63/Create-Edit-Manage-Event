@model WebApplicationProject.Models.Event
<style>
    .head {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        background-color: #f4f4f4;
        height: 200px;
        width: 100%;
        margin: 0;
    }

    h3 {
        margin: 20px 0;
    }
    .eventToEdit {
        border: 1px solid;
        border-radius: 8px;
        padding: 10px;
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
    }

    .eventImage Img {
        flex: 1;
        width: 100%;
        height: 200px;
        object-fit: cover;
        border-radius: 8px;
    }

    .eventDetail {
        flex: 2;
    }

    .tag-badge {
        background-color: black;
        color: white;
        padding: 1px;
        border-radius: 5px;
    }

    .editEvent {
        border: 1px solid;
        border-radius: 8px;
        padding: 10px;
    }

    .editEvent input {
        flex: 2;
        width: 100%;
        box-sizing: border-box;
    }

    .editEvent button {
        margin-top: 10px;
        background-color: black;
        color: white;
    }

    .mngParti{
        display: flex;
        gap: 20px;
        background-color: #f4f4f4;
        padding: 20px 0;
        box-shadow: -50vw 0 0 0 #f4f4f4, 50vw 0 0 0 #f4f4f4;
    }

    .partiTable{
        border: 1px solid;
        background-color: white;
        flex: 1;
        border-radius: 8px;
        padding: 10px;
    }

    .partiTable th, .partiTable td{
        padding: 10px;
    }

    .partiTable th:last-child, .partiTable td:last-child {
        text-align: right;
    }

    .partiTable td img{
        border-radius: 50%;
        object-fit: cover;
        height: 40px;
        width: 40px;
        margin-right: 10px;
    }

    .partiTable td button {
        border-radius: 8px;
        background-color: black;
        color: white;
    }

    .tableHeader{
        display: flex;
        justify-content: space-between;
    }

    .numOfParti{
        border: 1px solid;
        border-radius: 8px;
        background-color: #f4f4f4;
        padding: 6px 10px;
    }

    table{
        width: 100%
    }

</style>
@section Banner {
    <div class="head">
        <h1>Manage Event</h1>
        <p>จัดการกิจกรรม</p>
    </div>
}
<h3>กิจกรรมที่กำลังจัดการ</h3>
<div id="eventToEdit" class="eventToEdit">
    <div class="eventImage">
        <img id="prevImage" src=@Model.Image />
    </div>
    <div class="eventDetail">
        <h4 id="prevTitle"><b>ชื่อ</b>: @Model.Title</h4>
        <p id="prevDesc"><b>รายละเอียด:</b> @Model.Description</p>
        <div id="prevTags">
            <b>แท็ก:</b>
            @if (Model.Tag != null)
            {
                foreach (var tag in Model.Tag)
                {
                    <span class="tag-badge">@tag</span>
                }
            }
        </div>
        <div class="meta-info"><b>รับ:</b> <span id="prevCount">@Model.MaxParticipants</span> คน</div>
        <div class="meta-info"><span id="prevDate"><b>เวลา:</b> @Model.DateTime</span></div>
        <div class="meta-info"><span id="prevLocation"><b>สถานที่:</b> @Model.Location</span></div>
    </div>
</div>
<div class="mngParti">
    @{
        var userInEvent = ViewBag.ParticipantList as List<WebApplicationProject.Models.User>;
    }
    <div class="partiTable">
        <div class="tableHeader">
            <h4>รายชื่อตัวจริง</h4>
            <div class="numOfParti">@Model.CurrentParticipants / @Model.MaxParticipants Member</div>
        </div>
        <hr />
        <table>
            <thead>
                <tr>
                    <th>ลำดับ</th>
                    <th>ชื่อ</th>
                    <th>เวลาที่จอง</th>
                    <th>จัดการ</th>
                </tr>
            </thead>
            <tbody>
                @if (userInEvent != null){
                    int order = 1;
                    @foreach (var ticket in Model.Participants.Where(p => p.Status == ParticipationStatus.Confirmed).OrderBy(p => p.JoinedAt)){
                        var user = userInEvent.FirstOrDefault(u => u.Id == ticket.UserId);
                        if (user != null){
                            <tr>
                                <td>@order</td>
                                <td><img src="@user.Image" />@user.FName @user.SName</td>
                                <td>@ticket.JoinedAt</td>
                                <td><button>ลบ</button></td>
                            </tr>
                            order += 1;
                        }
                    }
                }
            </tbody>
        </table>
    </div>
    <div class="partiTable">
        <div class="tableHeader">
            <h4>รายชื่อสำรอง</h4>
        </div>
        <hr />
        <table>
            <thead>
                <tr>
                    <th>ลำดับ</th>
                    <th>ชื่อ</th>
                    <th>เวลาที่จอง</th>
                    <th>จัดการ</th>
                </tr>
            </thead>
            <tbody>
                @if (userInEvent != null)
                {
                    int order = 1;
                    @foreach (var ticket in Model.Participants.Where(p => p.Status == ParticipationStatus.Waiting).OrderBy(p => p.JoinedAt))
                    {
                        var user = userInEvent.FirstOrDefault(u => u.Id == ticket.UserId);
                        if (user != null){
                            <tr>
                                <td>@order</td>
                                <td><img src="@user.Image"/>@user.FName @user.SName</td>
                                <td>@ticket.JoinedAt</td>
                                <td><button>เพิ่ม</button></td>
                            </tr>
                            order += 1;
                        }
                    }
                }
            </tbody>
        </table>
    </div>
</div>