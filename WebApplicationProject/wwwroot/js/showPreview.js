let originalData = {};
document.addEventListener("DOMContentLoaded", function () {
    const inputTitle = document.getElementById("inputTitle");
    const inputDesc = document.getElementById("inputDesc");
    const inputImg = document.getElementById("inputImg");
    const inputTag = document.getElementById("inputTag");
    const inputMaxParti = document.getElementById("inputMaxParti");
    const inputDateTime = document.getElementById("inputDateTime");
    const inputLocation = document.getElementById("inputLocation");

    const prevImage = document.getElementById("prevImage");
    const prevTitle = document.getElementById("prevTitle");
    const prevDesc = document.getElementById("prevDesc");
    const prevTags = document.getElementById("prevTags");
    const prevMaxParti = document.getElementById("prevMaxParti");
    const prevDate = document.getElementById("prevDate");
    const prevLocation = document.getElementById("prevLocation");

    const resetbutton = document.getElementById("btnRst");

    originalData = {
        Title: inputTitle.value,
        Desc: inputDesc.value,
        Img: document.getElementById("oldImageUrl") ? document.getElementById("oldImageUrl").value : "",
        Tag: inputTag.value,
        MaxParti: inputMaxParti.value,
        DateTime: inputDateTime.value,
        Location: inputLocation.value,
    };

    inputTitle.addEventListener("input", function () {
        if (!this.value) {
            prevTitle.innerHTML = '(ชื่อกิจกรรมจะปรากฏที่นี่)';
            return;
        }
        prevTitle.innerHTML = this.value
    });

    inputDesc.addEventListener("input", function () {
        if (!this.value) {
            prevDesc.innerHTML = 'รายละเอียดต่างๆ ของกิจกรรม...';
            return;
        }
        prevDesc.innerHTML = this.value
    });

    inputImg.addEventListener("change", function () {
        const file = this.files[0];

        if (file) {
            prevImage.src = URL.createObjectURL(file);
        } else {
            prevImage.src = "https://img2.pic.in.th/image-icon-symbol-design-illustration-vector.md.jpg";
        }
    });

    inputTag.addEventListener("input", function () {
        let tagText = this.value
        if (!tagText) {
            prevTags.innerHTML = '<span class="tag-badge">#ตัวอย่างแท็ก</span>';
            return;
        }
        let badges = tagText.split(',').map(tag => `<span class="tag-badge">#${tag.trim()}</span>`).join(" ");
        prevTags.innerHTML = badges;
    });

    inputMaxParti.addEventListener("input", function () {
        if (!this.value) {
            prevMaxParti.innerHTML = 'XX';
            return;
        }
        prevMaxParti.innerHTML = this.value
    });

    inputDateTime.addEventListener("input", function () {
        const rawDate = this.value;
        const dateObj = new Date(rawDate);
        if (!this.value) {
            prevDate.innerHTML = 'XX เดือน XXXX - XX:XX น.';
            return;
        }
        const datePart = dateObj.toLocaleDateString('th-TH', {
            day: 'numeric',
            month: 'long',
            year: 'numeric'
        });
        const timePart = dateObj.toLocaleTimeString('th-TH', {
            hour: '2-digit',
            minute: '2-digit'
        });
        prevDate.innerHTML = `${datePart} - ${timePart} น.`
    });

    inputLocation.addEventListener("input", function () {
        if (!this.value) {
            prevLocation.innerHTML = 'ระบุสถานที่จัดงาน';
            return;
        }
        prevLocation.innerHTML = this.value
    });

    resetbutton.addEventListener("click", function () {
        if (inputTitle) inputTitle.value = originalData.Title;
        if (inputDesc) inputDesc.value = originalData.Desc;
        if (inputTag) inputTag.value = originalData.Tag;
        if (inputMaxParti) inputMaxParti.value = originalData.MaxParti;
        if (inputDateTime) inputDateTime.value = originalData.DateTime;
        if (inputLocation) inputLocation.value = originalData.Location;
        if (inputImg) {
            inputImg.value = "";
        }
        if (prevImage) {
            prevImage.src = originalData.Img ? originalData.Img : "https://img2.pic.in.th/image-icon-symbol-design-illustration-vector.md.jpg";
        }
        const event = new Event('input');
        if (inputTitle) inputTitle.dispatchEvent(event);
        if (inputDesc) inputDesc.dispatchEvent(event);
        if (inputTag) inputTag.dispatchEvent(event);
        if (inputMaxParti) inputMaxParti.dispatchEvent(event);
        if (inputDateTime) inputDateTime.dispatchEvent(event);
        if (inputLocation) inputLocation.dispatchEvent(event);
    })
    if (inputTag) inputTag.dispatchEvent(new Event('input'));
});